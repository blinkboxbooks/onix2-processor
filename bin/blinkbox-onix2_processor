#!/usr/bin/env ruby
$LOAD_PATH.unshift File.join(__dir__, "../lib")
require "blinkbox/common_config"
require "blinkbox/onix2_processor"

options = Blinkbox::CommonConfig.new

begin
  processor = Blinkbox::Onix2Processor::Service.new(options)
  processor.start
  processor.join
rescue SystemExit, Interrupt, SignalException
  processor.stop
rescue Exception => e
  begin
    processor.stop
  rescue
    # Try and stop the processor, just in case it'll help in this crash scenario
  end
  if processor && processor.logger
    processor.logger.fatal e
  else
    raise e
  end
end